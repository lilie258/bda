#äº†è§£æ•°æ®é›†çš„åŸºæœ¬æ“ä½œï¼šchipotle å¿«é¤æ•°æ®é›†
import pandas as pd 
import numpy as np
#æ•°æ®é›†å¯¼å…¥
chipotle_df=pd.read_csv('C:/Users/30722/jnu-homework/dataset/chipotle.csv')
#æ‰“å°åˆ—åç§°
#print(chipotle_df.columns)
#æŸ¥çœ‹åˆ—æ•°
#print(chipotle_df.shape)
#print(chipotle_df.shape[1])#(å®é™…ä¸Šæ‰“å°çš„æ˜¯shapeå±æ€§è¾“å‡ºçš„æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ )
#è§‚å¯Ÿç´¢å¼•
#print(chipotle_df.index)#RangeIndex(start=0, stop=4622, step=1)
#è¢«ä¸‹å•æ•°æœ€å¤šçš„å•†å“itemæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆç»Ÿè®¡å•†å“å‡ºç°æ¬¡æ•°æœ€å¤§å€¼å¹¶è¿”å›ï¼‰
#æ³¨æ„è¿™é‡Œä¸èƒ½åªç»Ÿè®¡item_nameåˆ—ï¼Œå› ä¸ºä¸‹å•çš„æ—¶å€™æœ‰å¯èƒ½ä¹°å‡ ä»¶ï¼Œä¹Ÿå°±æ˜¯è¦çœ‹quantityåˆ—ğŸ˜“
c = chipotle_df[['item_name','quantity']].groupby(['item_name'],as_index=False).agg({'quantity':sum})
#æ›´å¥½çš„å†™æ³•
c = chipotle_df[['item_name','quantity']].groupby(['item_name'],as_index=False)['quantity'].sum()
print(c)
#æ³¨æ„ä»¥åˆ—åä¸ºç´¢å¼•è¯»å–åˆ—çš„å†™æ³•ï¼Œyå› ä¸ºæœ‰ä¸¤ä¸ªåˆ—è¦è¯»å–ï¼Œæ‰€ä»¥å½¢æˆåˆ—ååˆ—è¡¨ï¼Œæ˜¯ä¸¤ä¸ªä¸­æ‹¬å·ä¸æ˜¯ä¸€ä¸ªä¸­æ‹¬å·
#aggæ˜¯èšåˆå‡½æ•°ï¼Œç”¨aggå®ç°sumçš„æ•ˆæœè¦é‡Œé¢åŠ ä¸ªå­—å…¸{'quantity':sum}
#aggèšåˆå‡½æ•°çš„ç”¨æ³•ï¼š
'''
GroupBy å¯¹è±¡çš„ agg()ï¼ˆæœ€å¸¸ç”¨åœºæ™¯ï¼‰:grouped_obj.agg(func, *args, **kwargs)
DataFrame å¯¹è±¡çš„ agg():df.agg(func, axis=0, *args, **kwargs)
Series å¯¹è±¡çš„ agg():series.agg(func, *args, **kwargs)
func æ”¯æŒå•ä¸ªå‡½æ•°ã€å‡½æ•°åˆ—è¡¨ã€å­—å…¸ç­‰å½¢å¼ï¼Œçµæ´»é€‚é…ä¸åŒèšåˆéœ€æ±‚ï¼š
å¦‚æœæ˜¯å¯¹åˆ†ç»„åçš„åˆ—ç›´æ¥æ±‚å’Œï¼Œå¯ä»¥å•ä¸ªèšåˆå‡½æ•°ï¼ˆå­—ç¬¦ä¸² / å†…ç½®å‡½æ•° / è‡ªå®šä¹‰å‡½æ•°ï¼‰ï¼šgrouped.agg('sum') 
å¦‚æœæ˜¯è¦ç”Ÿæˆå¤šä¸ªè®¡ç®—å€¼ï¼Œå¯ä»¥ç”¨ å‡½æ•°åˆ—è¡¨ï¼ˆå¯¹åŒä¸€åˆ—æ‰§è¡Œå¤šä¸ªèšåˆæ“ä½œï¼‰ï¼šdf.groupby('A')['B'].agg(['sum', 'min'])
å¦‚æœæ˜¯æŒ‡å®šä¸åŒåˆ—å¯¹åº”ä¸åŒèšåˆæ“ä½œï¼Œè¦ç”¨å­—å…¸ï¼šdf.groupby('A').agg({
    'B': 'max',
    'C': np.mean
})
'''
c.sort_values(['quantity'],ascending=False,inplace=True)
#print(c.head())
#åœ¨item_nameè¿™ä¸€åˆ—ä¸­ï¼Œä¸€å…±æœ‰å¤šå°‘ç§å•†å“è¢«ä¸‹å•ï¼Ÿ
#print(c.info())
#ä¹Ÿå¯ä»¥ç”¨chipo['item_name'].nunique()
#åœ¨choice_descriptionä¸­ï¼Œä¸‹å•æ¬¡æ•°æœ€å¤šçš„å•†å“æ˜¯ä»€ä¹ˆï¼Ÿ
#print(chipotle_df['choice_description'].value_counts().head())
# ä¸€å…±æœ‰å¤šå°‘å•†å“è¢«ä¸‹å•
total_item_order=chipotle_df['quantity'].sum()
#print(total_item_order)
#å°†item_priceè½¬æ¢ä¸ºæµ®ç‚¹æ•°
dollarizer = lambda x: float(x[1:-1])
chipotle_df['item_price'] = chipotle_df['item_price'].apply(dollarizer)
#åœ¨è¯¥æ•°æ®é›†å¯¹åº”çš„æ—¶æœŸå†…ï¼Œæ”¶å…¥(revenue)æ˜¯å¤šå°‘ï¼Œè¿™é‡Œç›¸å½“äºæ–°å¢ä¸€åˆ—ç„¶ååŠ æ€»
chipotle_df['sub_total'] = round(chipotle_df['item_price'] * chipotle_df['quantity'],2)
chipotle_df['sub_total'].sum()

#æ•°æ®è¿‡æ»¤ä¸æ’åºï¼šæ¢ç´¢2012æ¬§æ´²æ¯æ•°æ®
euro12=pd.read_csv('C:/Users/30722/jnu-homework/dataset/Euro2012_stats.csv')
#åªé€‰å– Goals è¿™ä¸€åˆ—
euro12goal=euro12['Goals']
#å°†æ•°æ®é›†ä¸­çš„åˆ—Team, Yellow Cardså’ŒRed Cardså•ç‹¬å­˜ä¸ºä¸€ä¸ªåå«disciplineçš„æ•°æ®æ¡†
discipline=euro12[['Team','Yellow Cards','Red Cards']]
#å¯¹æ•°æ®æ¡†disciplineæŒ‰ç…§å…ˆRed Cardså†Yellow Cardsè¿›è¡Œæ’åº
# #æ³¨æ„ï¼šå¥æ„æ˜¯å¯¹ discipline æ•°æ®æ¡†ï¼Œå…ˆæŒ‰ã€ŒRed Cards çº¢ç‰Œã€åˆ—æ’åºï¼Œçº¢ç‰Œç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå†æŒ‰ã€ŒYellow Cards é»„ç‰Œã€åˆ—æ’åº
discipline=discipline.sort_values(['Red Cards','Yellow Cards'])
#print(discipline)
#è®¡ç®—æ¯ä¸ªçƒé˜Ÿæ‹¿åˆ°çš„é»„ç‰Œæ•°çš„å¹³å‡å€¼
#print(discipline['Yellow Cards'].mean())
#æ‰¾åˆ°è¿›çƒæ•°Goalsè¶…è¿‡6çš„çƒé˜Ÿæ•°æ®
#print(euro12[euro12goal['Goals']>6])è¿™ä¸ªä¸å¯¹ï¼Œå› ä¸ºä¹‹å‰æŠŠ euro12goal å®šä¹‰æˆäº† euro12['Goals']ï¼ˆå³ä¸€ä¸ª Seriesï¼‰ï¼Œè€Œ Series æ²¡æœ‰'Goals'è¿™ä¸ªé”®ï¼Œæ‰€ä»¥ euro12goal['Goals'] ä¼šæŠ¥KeyErrorã€‚
#print(euro12[euro12goal>6])
#é€‰å–ä»¥å­—æ¯Gå¼€å¤´çš„çƒé˜Ÿæ•°æ®
#print(euro12[euro12.Team.str.startswith('G')])
#é€‰å–å‰7åˆ—
#æ³¨æ„è¿™é‡Œä¸èƒ½ç”¨locåªèƒ½ç”¨ilocï¼Œå› ä¸ºlocæ˜¯åŸºäºã€Œæ ‡ç­¾ï¼ˆåˆ—å / è¡Œåï¼‰ã€ç´¢å¼•ï¼Œè€Œilocæ˜¯åŸºäºã€Œæ•´æ•°ä½ç½®ã€ç´¢å¼•
#print(euro12.iloc[:,0:7])
#é€‰å–é™¤äº†æœ€å3åˆ—ä¹‹å¤–çš„å…¨éƒ¨åˆ—
euro12.iloc[: , :-3]
#æ‰¾åˆ°è‹±æ ¼å…°(England)ã€æ„å¤§åˆ©(Italy)å’Œä¿„ç½—æ–¯(Russia)çš„å°„æ­£ç‡(Shooting Accuracy)
#ç”¨isinå‡½æ•°
#print(euro12.loc[euro12['Team'].isin(['England', 'Italy', 'Russia']), ['Team','Shooting Accuracy']])
#df.loc[ è¡Œç­›é€‰æ¡ä»¶ , åˆ—ç­›é€‰æ¡ä»¶ ]
#è¡Œç­›é€‰æ¡ä»¶ï¼šeuro12['Team'].isin(['England', 'Italy', 'Russia'])
#åˆ—ç­›é€‰æ¡ä»¶ï¼š['Team','Shooting Accuracy']
'''
       Team Shooting Accuracy
3   England             50.0%
7     Italy             43.0%
12   Russia             22.5%
'''

#æ•°æ®åˆ†ç»„ï¼šæ¢ç´¢é…’ç±»æ¶ˆè´¹æ•°æ®
drinks=pd.read_csv('C:/Users/30722/jnu-homework/dataset/drinks.csv')
#å“ªä¸ªå¤§é™†(continent)å¹³å‡æ¶ˆè€—çš„å•¤é…’(beer)æ›´å¤šï¼Ÿ
#print(drinks.groupby('continent')['beer_servings'].mean())
#æ‰“å°å‡ºæ¯ä¸ªå¤§é™†(continent)çš„çº¢é…’æ¶ˆè€—(wine_servings)çš„æè¿°æ€§ç»Ÿè®¡å€¼
#print(drinks.groupby('continent')['wine_servings'].describe())
#æ‰“å°å‡ºæ¯ä¸ªå¤§é™†å¯¹spirité¥®å“æ¶ˆè€—çš„å¹³å‡å€¼ï¼Œæœ€å¤§å€¼å’Œæœ€å°å€¼
#print(drinks.groupby('continent')['spirit_servings'].agg(['mean', 'min', 'max']))

#Applyå‡½æ•°:æ¢ç´¢1960 - 2014 ç¾å›½çŠ¯ç½ªæ•°æ®
crime=pd.read_csv(r"C:\Users\30722\jnu-homework\dataset\US_Crime_Rates_1960_2014.csv")
#å°†Yearçš„æ•°æ®ç±»å‹è½¬æ¢ä¸º datetime64
#ç”¨to_datetime
crime['Year']=pd.to_datetime(crime['Year'])
#print(crime.info())
#å°†åˆ—Yearè®¾ç½®ä¸ºæ•°æ®æ¡†çš„ç´¢å¼•
crime=crime.set_index('Year')
#print(crime)
#åˆ é™¤åä¸ºTotalçš„åˆ—
del crime['Total']
#æŒ‰ç…§Yearå¯¹æ•°æ®æ¡†è¿›è¡Œåˆ†ç»„å¹¶æ±‚å’Œ
#æ³¨æ„Populationè¿™ä¸€åˆ—ï¼Œè‹¥ç›´æ¥å¯¹å…¶æ±‚å’Œï¼Œæ˜¯ä¸æ­£ç¡®çš„
crimes = crime.resample('10YS').sum() # resample a time series per decades
#print(crimes)
# ç”¨resampleå»å¾—åˆ°â€œPopulationâ€åˆ—çš„æœ€å¤§å€¼
population = crime['Population'].resample('10YS').max()
# æ›´æ–° "Population" 
crimes['Population'] = population
#print(crimes)
#ä½•æ—¶æ˜¯ç¾å›½å†å²ä¸Šç”Ÿå­˜æœ€å±é™©çš„å¹´ä»£ï¼Ÿç”¨idxmaxæ–¹æ³•æ¥åˆ†åˆ«é˜Ÿæ¯ä¸€åˆ—è¿›è¡Œæ±‚æœ€å¤§å€¼
#idxmaxæ˜¯ pandas ä¸­ç”¨äºå®šä½ã€Œæœ€å¤§å€¼å¯¹åº”çš„ç´¢å¼•æ ‡ç­¾ã€ çš„å‡½æ•°
#print(crime.idxmax())

#åˆå¹¶ï¼šæ¢ç´¢è™šæ‹Ÿå§“åæ•°æ®
#all_data = pd.concat([data1, data2],axis=0/axis=1)
#æŒ‰ç…§subject_idçš„å€¼å¯¹all_dataå’Œdata3ä½œåˆå¹¶
#pd.merge(all_data, data3, on='subject_id')
#å¯¹data1å’Œdata2æŒ‰ç…§subject_idä½œè¿æ¥
#pd.merge(data1, data2, on='subject_id', how='inner')
#æ‰¾åˆ° data1 å’Œ data2 åˆå¹¶ä¹‹åçš„æ‰€æœ‰åŒ¹é…ç»“æœ
#pd.merge(data1, data2, on='subject_id', how='outer')

#ç»Ÿè®¡ï¼šæ¢ç´¢é£é€Ÿæ•°æ®
import datetime
data = pd.read_table("C:/Users/30722/jnu-homework/dataset/wind.data",sep = "\s+", parse_dates = [[0,1,2]]) 
# 2061å¹´ï¼Ÿæˆ‘ä»¬çœŸçš„æœ‰è¿™ä¸€å¹´çš„æ•°æ®ï¼Ÿåˆ›å»ºä¸€ä¸ªå‡½æ•°å¹¶ç”¨å®ƒå»ä¿®å¤è¿™ä¸ªbug
def fix_century(x):
    year = x.year - 100 if x.year > 2026 else x.year
    return datetime.date(year, x.month, x.day)
data['Yr_Mo_Dy'] = data['Yr_Mo_Dy'].apply(fix_century)
#print(data)
#å°†æ—¥æœŸè®¾ä¸ºç´¢å¼•ï¼Œæ³¨æ„æ•°æ®ç±»å‹ï¼Œåº”è¯¥æ˜¯datetime64[ns]
data["Yr_Mo_Dy"] = pd.to_datetime(data["Yr_Mo_Dy"])
data = data.set_index('Yr_Mo_Dy')
#print(data)
#å¯¹åº”æ¯ä¸€ä¸ªlocationï¼Œä¸€å…±æœ‰å¤šå°‘æ•°æ®å€¼ç¼ºå¤±
#print(data.isnull().sum())
#å¯¹åº”æ¯ä¸€ä¸ªlocationï¼Œä¸€å…±æœ‰å¤šå°‘å®Œæ•´çš„æ•°æ®å€¼
#print(data.shape)
#print(data.shape[0]-data.isnull().sum())
#å¯¹äºå…¨ä½“æ•°æ®ï¼Œè®¡ç®—é£é€Ÿçš„å¹³å‡å€¼
data.mean().mean()#å•ä¸€ä¸ªmeanåªèƒ½å–æ¯ä¸ªåœ°æ–¹çš„å¹³å‡ï¼ï¼ï¼è€Œä¸æ˜¯å¹´ä»½çš„å¹³å‡
#print(data.mean())
# åˆ›å»ºä¸€ä¸ªåä¸ºloc_statsçš„æ•°æ®æ¡†å»è®¡ç®—å¹¶å­˜å‚¨æ¯ä¸ªlocationçš„é£é€Ÿæœ€å°å€¼ï¼Œæœ€å¤§å€¼ï¼Œå¹³å‡å€¼å’Œæ ‡å‡†å·®
# è¿™é‡Œä¸èƒ½ç”¨agg
loc_stats = pd.DataFrame()
loc_stats['min'] = data.min(axis=0) # min
loc_stats['max'] = data.max(axis=0) # max 
loc_stats['mean'] = data.mean(axis=0) # mean
loc_stats['std'] = data.std(axis=0) # standard deviations
#print(loc_stats)#day_statsè¦æ”¹æˆaxis=1
#æ€ä¹ˆæŠŠç´¢å¼•åŠ æˆæ–°çš„ä¸€åˆ—ï¼Ÿ#
data['date'] = data.index
# å¯¹äºæ¯ä¸€ä¸ªlocationï¼Œè®¡ç®—ä¸€æœˆä»½çš„å¹³å‡é£é€Ÿ
#æ³¨æ„ï¼Œ1961å¹´çš„1æœˆå’Œ1962å¹´çš„1æœˆåº”è¯¥åŒºåˆ«å¯¹å¾…
data['month'] = data['date'].apply(lambda date: date.month)
data['year'] = data['date'].apply(lambda date: date.year)
data['day'] = data['date'].apply(lambda date: date.day)
january_winds = data[data['month']== 1]
#print(january_winds)
#print(january_winds.loc[:,'RPT':"MAL"].mean())
#å¯¹äºæ•°æ®è®°å½•æŒ‰ç…§å¹´ä¸ºé¢‘ç‡å–æ ·
#ç”¨resampleä¸è¡Œï¼Œå› ä¸ºæ²¡æœ‰åŠ è¦èšåˆä»€ä¹ˆå€¼ï¼Œæ¯”å¦‚meanï¼ˆï¼‰
#data_1YS=data.resample('1YS')#è¿™ä¸ªä¸è¡Œ
data.query('month == 1 and day == 1')#è¿™ä¸ªå¯ä»¥

#å¯è§†åŒ–ç»ƒä¹ 
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np
